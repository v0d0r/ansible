---
- name: Configure dynamic bash prompt
  hosts: all
  become: yes

  tasks:
    - name: Install PS1 script for all users
      template:
        src: colorprompt.sh.j2
        dest: /etc/profile.d/colorprompt.sh
        owner: root
        group: root
        mode: '0644'
      become: true
      become_user: root

    - name: Ensure colorprompt is sourced in all interactive shells
      lineinfile:
        path: /etc/bash.bashrc
        line: '[[ $- == *i* ]] && [ -f /etc/profile.d/colorprompt.sh ] && source /etc/profile.d/colorprompt.sh'
        state: present
        create: yes
      become: true
