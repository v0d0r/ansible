#!/bin/bash
# Dynamic PS1 installed by Ansible
# Applies only for interactive shells
case $- in
  *i*) ;;
  *) return ;;
esac

RESET="\[\e[0m\]"

# Base colors
GREY="\[\e[0;37m\]"
ENV_RED="\[\e[31m\]"
ENV_ORANGE="\[\e[38;5;208m\]"
ENV_GREEN="\[\e[32m\]"

# User colors
USER_PASTEL="\[\e[38;5;110m\]"
USER_ROOT="\[\e[38;5;167m\]"

# Detect env from hostname (expects .prod., .stage., .dev.)
_lc_host="$(printf '%s' "$HOSTNAME" | tr '[:upper:]' '[:lower:]')"
if printf '%s' "$_lc_host" | grep -q '\.prod\.'; then
  ENV_LABEL="PROD"; ENV_COLOR="$ENV_RED"
elif printf '%s' "$_lc_host" | grep -q '\.stage\.'; then
  ENV_LABEL="STAGE"; ENV_COLOR="$ENV_ORANGE"
elif printf '%s' "$_lc_host" | grep -q '\.dev\.'; then
  ENV_LABEL="DEV"; ENV_COLOR="$ENV_GREEN"
else
  ENV_LABEL="UNKNOWN"; ENV_COLOR="$GREY"
fi

# Username color and prompt char
if [ "$EUID" -eq 0 ]; then
  _USER_COLOR="$USER_ROOT"
  _PROMPT_CHAR="#"
else
  _USER_COLOR="$USER_PASTEL"
  _PROMPT_CHAR="$"
fi

# Build PS1:
export PS1="${ENV_COLOR}${ENV_LABEL}${RESET} ${GREY}[${RESET}${_USER_COLOR}\u${RESET}${GREY}@\h \w]${RESET}${GREY}${_PROMPT_CHAR} ${RESET}"
